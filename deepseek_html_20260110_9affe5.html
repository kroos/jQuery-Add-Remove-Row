<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Complete remAddRow Plugin Example</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .custom-row {
            border: 2px solid #007bff;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            background-color: #f8f9fa;
            transition: all 0.3s ease;
        }
        .custom-row:hover {
            background-color: #e9ecef;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .custom-remove-btn {
            margin-top: 15px;
            border-radius: 20px;
            padding: 5px 20px;
        }
        .form-control-custom {
            border: 2px solid #28a745;
            border-radius: 5px;
        }
        .stats {
            background-color: #e9ecef;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .highlight {
            background-color: #fff3cd;
            padding: 2px 5px;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <h1 class="mb-4">Complete remAddRow Plugin Example</h1>
        
        <!-- Stats Display -->
        <div class="row stats">
            <div class="col-md-12">
                <h4>Plugin Statistics</h4>
                <div class="row">
                    <div class="col-md-3">
                        <strong>Current Rows:</strong> <span id="rowCount">0</span>/<span id="maxRows">7</span>
                    </div>
                    <div class="col-md-3">
                        <strong>Last Action:</strong> <span id="lastAction">None</span>
                    </div>
                    <div class="col-md-3">
                        <strong>Last Index:</strong> <span id="lastIndex">-</span>
                    </div>
                    <div class="col-md-3">
                        <strong>Total Added:</strong> <span id="totalAdded">0</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Control Panel -->
        <div class="card mb-4">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0">Control Panel</h4>
            </div>
            <div class="card-body">
                <div class="row mb-3">
                    <div class="col-md-12">
                        <h5>Row Operations</h5>
                        <button type="button" id="addRowBtn" class="btn btn-success">Add Row (Default)</button>
                        <button type="button" id="addProgrammatic" class="btn btn-info">Add Programmatically</button>
                        <button type="button" id="removeFirst" class="btn btn-warning">Remove First Row</button>
                        <button type="button" id="removeLast" class="btn btn-warning">Remove Last Row</button>
                        <button type="button" id="resetAll" class="btn btn-danger">Reset All</button>
                        <button type="button" id="manualReindex" class="btn btn-secondary">Manual Reindex</button>
                    </div>
                </div>
                
                <div class="row mb-3">
                    <div class="col-md-12">
                        <h5>Configuration Panel</h5>
                        <div class="form-inline mb-2">
                            <label class="mr-2">Field Name:</label>
                            <input type="text" id="fieldNameInput" class="form-control form-control-sm mr-3" value="users">
                            <button id="updateFieldName" class="btn btn-sm btn-outline-primary">Update</button>
                        </div>
                        <div class="form-inline mb-2">
                            <label class="mr-2">Max Rows:</label>
                            <input type="number" id="maxRowsInput" class="form-control form-control-sm mr-3" value="7" min="1" max="20">
                            <button id="updateMaxRows" class="btn btn-sm btn-outline-primary">Update</button>
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-12">
                        <h5>Reindexing Configuration</h5>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label>Name Attributes (${fieldName}[${index}][field]):</label>
                                    <input type="text" id="nameAttrs" class="form-control form-control-sm" 
                                           value="name,data-name,custom-field" placeholder="Comma separated">
                                    <small class="form-text text-muted">Pattern: users[0][name]</small>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label>ID Attributes (userdefine_${index}):</label>
                                    <input type="text" id="idAttrs" class="form-control form-control-sm" 
                                           value="id,for,data-target,aria-labelledby" placeholder="Comma separated">
                                    <small class="form-text text-muted">Pattern: name_0, skill_1</small>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label>Index Attributes ([${index}]):</label>
                                    <input type="text" id="indexAttrs" class="form-control form-control-sm" 
                                           value="data-index,data-row,data-id,row-index" placeholder="Comma separated">
                                    <small class="form-text text-muted">Pattern: data-index="0"</small>
                                </div>
                            </div>
                        </div>
                        <button id="updateReindexConfig" class="btn btn-primary btn-sm">Update Reindex Config</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Main Content Area -->
        <div class="row">
            <div class="col-sm-12 m-0 my-2">
                <button type="button" id="customAddBtn" class="btn btn-lg btn-primary">
                    <i class="fas fa-plus"></i> Add Custom Row
                </button>
                <button type="button" id="showConfig" class="btn btn-outline-info btn-sm">Show Current Config</button>
            </div>
            <div id="rowWrapper" class="col-sm-12 m-0 my-2"></div>
        </div>
        
        <!-- Debug Output -->
        <div class="card mt-4">
            <div class="card-header bg-dark text-white">
                <h4 class="mb-0">Debug & Output</h4>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h5>Console Output</h5>
                        <div id="consoleOutput" class="border p-2" style="height: 200px; overflow-y: scroll; background-color: #f5f5f5;"></div>
                    </div>
                    <div class="col-md-6">
                        <h5>Current Form Data</h5>
                        <pre id="formDataOutput" class="border p-2" style="height: 200px; overflow-y: scroll; background-color: #f5f5f5;"></pre>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <!-- Our Plugin -->
    <script src="remAddRow.js"></script>
    
    <script>
        $(document).ready(function() {
            // Log function
            function log(message, type = 'info') {
                const time = new Date().toLocaleTimeString();
                const typeClass = type === 'error' ? 'text-danger' : type === 'warning' ? 'text-warning' : 'text-info';
                $('#consoleOutput').prepend(`<div class="${typeClass}"><strong>[${time}]</strong> ${message}</div>`);
                console.log(`[${type.toUpperCase()}] ${message}`);
            }
            
            // Update stats display
            function updateStats(action = '', index = '') {
                $('#lastAction').text(action || 'None');
                $('#lastIndex').text(index !== '' ? index : '-');
                $('#totalAdded').text(window.totalAdded || 0);
            }
            
            // Update form data display
            function updateFormData() {
                const data = {};
                $('#rowWrapper .custom-row-class').each(function() {
                    const $row = $(this);
                    const rowIndex = $row.data('index');
                    data[rowIndex] = {
                        id: $row.find('input[name*="[id]"]').val(),
                        name: $row.find('input[name*="[name]"]').val(),
                        email: $row.find('input[name*="[email]"]').val(),
                        experience: $row.find('select[name*="[experience]"]').val(),
                        skills: $row.find('input[name*="[skills]"]').val(),
                        notes: $row.find('textarea[name*="[notes]"]').val()
                    };
                });
                $('#formDataOutput').text(JSON.stringify(data, null, 2));
            }
            
            // Global counter for total added rows
            window.totalAdded = 0;
            
            // Custom HTML Template Function
            function customRowTemplate(index, settings) {
                return `
                    <div id="${settings.fieldName}_${index}" 
                         class="row m-0 custom-row custom-row-class" 
                         data-index="${index}"
                         data-row="${index}"
                         data-id="${index + 1000}"
                         data-custom="row-${index}">
                        
                        <input type="hidden" 
                               name="${settings.fieldName}[${index}][id]" 
                               value="ID-${index + 1000}"
                               data-name="${settings.fieldName}_id_${index}"
                               custom-field="hidden_${index}">
                        
                        <div class="col-md-12 mb-2">
                            <h5 class="border-bottom pb-2">
                                <i class="fas fa-user text-primary"></i> 
                                User Profile #<span class="highlight">${index}</span>
                                <small class="float-right text-muted">ID: <span class="highlight">${index + 1000}</span></small>
                            </h5>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="name_${index}" 
                                       class="font-weight-bold"
                                       data-target="name-label-${index}"
                                       aria-labelledby="name_${index}">
                                    <i class="fas fa-signature"></i> Full Name:
                                </label>
                                <input type="text" 
                                       name="${settings.fieldName}[${index}][name]" 
                                       value="User ${index}"
                                       id="name_${index}" 
                                       class="form-control form-control-custom"
                                       placeholder="Enter full name"
                                       data-index="${index}"
                                       data-row="${index}"
                                       custom-field="name_${index}"
                                       data-name="${settings.fieldName}_name_${index}">
                            </div>
                            
                            <div class="form-group">
                                <label for="email_${index}" class="font-weight-bold">
                                    <i class="fas fa-envelope"></i> Email Address:
                                </label>
                                <input type="email" 
                                       name="${settings.fieldName}[${index}][email]" 
                                       value="user${index}@example.com"
                                       id="email_${index}" 
                                       class="form-control form-control-custom"
                                       placeholder="Enter email"
                                       data-index="${index}">
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="experience_${index}" class="font-weight-bold">
                                    <i class="fas fa-chart-line"></i> Experience Level:
                                </label>
                                <select name="${settings.fieldName}[${index}][experience]" 
                                        id="experience_${index}" 
                                        class="form-control form-control-custom"
                                        data-index="${index}">
                                    <option value="beginner">Beginner</option>
                                    <option value="intermediate" selected>Intermediate</option>
                                    <option value="advanced">Advanced</option>
                                    <option value="expert">Expert</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="skills_${index}" class="font-weight-bold">
                                    <i class="fas fa-cogs"></i> Skills (comma separated):
                                </label>
                                <input type="text" 
                                       name="${settings.fieldName}[${index}][skills]" 
                                       value="HTML, CSS, JavaScript"
                                       id="skills_${index}" 
                                       class="form-control form-control-custom"
                                       placeholder="e.g., HTML, CSS, JavaScript"
                                       data-index="${index}">
                            </div>
                        </div>
                        
                        <div class="col-md-12">
                            <div class="form-group">
                                <label for="notes_${index}" class="font-weight-bold">
                                    <i class="fas fa-sticky-note"></i> Additional Notes:
                                </label>
                                <textarea name="${settings.fieldName}[${index}][notes]" 
                                          id="notes_${index}" 
                                          class="form-control form-control-custom"
                                          placeholder="Enter any additional notes..."
                                          rows="2"
                                          data-index="${index}"
                                          data-row="${index}">Notes for user ${index}</textarea>
                            </div>
                        </div>
                        
                        <div class="col-md-12 text-right">
                            <button type="button" 
                                    class="btn btn-danger custom-remove-btn ${settings.removeClass}"
                                    data-index="${index}"
                                    data-row="${index}"
                                    data-custom="remove-${index}"
                                    title="Remove this row">
                                <i class="fas fa-trash-alt"></i> Remove User #<span class="highlight">${index}</span>
                            </button>
                            <span class="ml-3 text-muted">
                                <i class="fas fa-fingerprint"></i> Row ID: <code>${settings.fieldName}_${index}</code>
                            </span>
                        </div>
                        
                        <div class="col-md-12 mt-2 border-top pt-2">
                            <small class="text-muted">
                                <i class="fas fa-info-circle"></i> 
                                Attributes to reindex: 
                                <span class="badge badge-info">name</span>
                                <span class="badge badge-info">id</span>
                                <span class="badge badge-info">for</span>
                                <span class="badge badge-info">data-index</span>
                                <span class="badge badge-info">data-row</span>
                                <span class="badge badge-info">data-id</span>
                                <span class="badge badge-info">data-name</span>
                                <span class="badge badge-info">custom-field</span>
                                <span class="badge badge-info">data-target</span>
                                <span class="badge badge-info">aria-labelledby</span>
                            </small>
                        </div>
                    </div>
                `;
            }
            
            // Custom onAdd callback
            function onAddCallback(index, $row) {
                window.totalAdded++;
                log(`âœ… Row ADDED at index ${index}. Total added: ${window.totalAdded}`, 'info');
                updateStats('Added', index);
                updateFormData();
                
                // Update row count
                const count = plugin.getCount();
                $('#rowCount').text(count);
                
                // Highlight the new row
                $row.css('border-color', '#28a745');
                setTimeout(() => {
                    $row.css('border-color', '#007bff');
                }, 1000);
                
                // Log row details
                log(`Row ${index} details: ID=${$row.attr('id')}, Fields: ${$row.find('input, select, textarea').length} elements`);
                
                // Add a custom data attribute
                $row.attr('data-added-at', new Date().toISOString());
                $row.attr('data-total-added', window.totalAdded);
            }
            
            // Custom onRemove callback
            function onRemoveCallback(index, $row) {
                log(`âš ï¸ Attempting to REMOVE row at index ${index}`, 'warning');
                updateStats('Removing', index);
                
                // Example: Ask for confirmation (return false to prevent removal)
                const confirmed = confirm(`Are you sure you want to remove row ${index}?\n\nUser: ${$row.find('input[name*="[name]"]').val()}`);
                
                if (!confirmed) {
                    log(`âŒ Removal CANCELLED for row ${index}`, 'error');
                    updateStats('Cancelled', index);
                    return false; // This prevents removal
                }
                
                log(`ðŸ—‘ï¸ Row ${index} REMOVED successfully`, 'info');
                updateStats('Removed', index);
                updateFormData();
                
                // Update row count
                const count = plugin.getCount();
                $('#rowCount').text(count);
                
                return true; // Allow removal
            }
            
            // Initialize the plugin with ALL options
            log('Initializing remAddRow plugin with all options...', 'info');
            
            const plugin = $('#rowWrapper').remAddRow({
                // Basic Configuration
                addButton: '#customAddBtn',
                maxRows: 7,
                fieldName: 'users',
                rowClass: 'custom-row-class',
                removeClass: 'custom-remove-btn',
                
                // Advanced Configuration
                reindexRowName: ['name', 'data-name', 'custom-field'],
                reindexRowID: ['id', 'for', 'data-target', 'aria-labelledby'],
                reindexRowIndex: ['data-index', 'data-row', 'data-id', 'row-index'],
                
                // Custom HTML Template
                rowTemplate: customRowTemplate,
                
                // Event Callbacks
                onAdd: onAddCallback,
                onRemove: onRemoveCallback
            });
            
            // Initialize stats
            $('#rowCount').text(plugin.getCount());
            $('#maxRows').text(7);
            updateStats('Initialized');
            
            // Control Panel Event Handlers
            $('#addProgrammatic').click(function() {
                log('Programmatically adding a row...', 'info');
                plugin.add();
            });
            
            $('#removeFirst').click(function() {
                const count = plugin.getCount();
                if (count > 0) {
                    log('Removing first row (index 0)...', 'warning');
                    plugin.remove(0);
                } else {
                    log('No rows to remove!', 'error');
                }
            });
            
            $('#removeLast').click(function() {
                const count = plugin.getCount();
                if (count > 0) {
                    const lastIndex = count - 1;
                    log(`Removing last row (index ${lastIndex})...`, 'warning');
                    plugin.remove(lastIndex);
                } else {
                    log('No rows to remove!', 'error');
                }
            });
            
            $('#resetAll').click(function() {
                log('Resetting all rows...', 'warning');
                plugin.reset();
                window.totalAdded = 0;
                updateStats('Reset');
                updateFormData();
                $('#rowCount').text(0);
            });
            
            $('#manualReindex').click(function() {
                log('Manually triggering reindex...', 'info');
                plugin.reindexAll();
                updateFormData();
                log('Manual reindex completed!', 'info');
            });
            
            $('#updateFieldName').click(function() {
                const newFieldName = $('#fieldNameInput').val();
                if (newFieldName && newFieldName !== plugin.getConfig().fieldName) {
                    log(`Updating field name to: ${newFieldName}`, 'info');
                    // Note: Field name change requires reinitialization in current implementation
                    // For production, you might want to add a setFieldName method
                    alert('Field name change would require plugin reinitialization. This feature requires enhancement.');
                }
            });
            
            $('#updateMaxRows').click(function() {
                const newMaxRows = parseInt($('#maxRowsInput').val());
                if (newMaxRows > 0 && newMaxRows <= 20) {
                    // Note: maxRows change requires reinitialization
                    $('#maxRows').text(newMaxRows);
                    log(`Max rows updated to: ${newMaxRows} (Note: Requires page refresh to take effect)`, 'info');
                }
            });
            
            $('#updateReindexConfig').click(function() {
                const nameAttrs = $('#nameAttrs').val().split(',').map(s => s.trim()).filter(s => s);
                const idAttrs = $('#idAttrs').val().split(',').map(s => s.trim()).filter(s => s);
                const indexAttrs = $('#indexAttrs').val().split(',').map(s => s.trim()).filter(s => s);
                
                plugin.setReindexConfig('name', nameAttrs)
                      .setReindexConfig('id', idAttrs)
                      .setReindexConfig('index', indexAttrs);
                
                log(`Reindex config updated:`, 'info');
                log(`  Name attributes: ${nameAttrs.join(', ')}`, 'info');
                log(`  ID attributes: ${idAttrs.join(', ')}`, 'info');
                log(`  Index attributes: ${indexAttrs.join(', ')}`, 'info');
                
                // Show current config
                showCurrentConfig();
            });
            
            $('#showConfig').click(function() {
                showCurrentConfig();
            });
            
            // Show initial config
            function showCurrentConfig() {
                const config = plugin.getConfig();
                log('=== CURRENT PLUGIN CONFIGURATION ===', 'info');
                log(`Field Name: ${config.fieldName}`, 'info');
                log(`Row Class: ${config.rowClass}`, 'info');
                log(`Remove Class: ${config.removeClass}`, 'info');
                log(`Max Rows: ${config.maxRows}`, 'info');
                log(`Current Index: ${config.currentIndex}`, 'info');
                log(`Name Attributes: ${config.reindexConfig.name.join(', ')}`, 'info');
                log(`ID Attributes: ${config.reindexConfig.id.join(', ')}`, 'info');
                log(`Index Attributes: ${config.reindexConfig.index.join(', ')}`, 'info');
                log('====================================', 'info');
            }
            
            // Add a few rows initially for demonstration
            setTimeout(() => {
                log('Adding initial demo rows...', 'info');
                plugin.add();
                plugin.add();
                plugin.add();
                
                // Show initial config
                showCurrentConfig();
                
                // Initial form data
                updateFormData();
            }, 500);
            
            // Keyboard shortcuts
            $(document).keydown(function(e) {
                // Ctrl+A to add row
                if (e.ctrlKey && e.key === 'a') {
                    e.preventDefault();
                    plugin.add();
                }
                // Ctrl+R to remove first row
                if (e.ctrlKey && e.key === 'r') {
                    e.preventDefault();
                    if (plugin.getCount() > 0) {
                        plugin.remove(0);
                    }
                }
                // Ctrl+I to reindex
                if (e.ctrlKey && e.key === 'i') {
                    e.preventDefault();
                    plugin.reindexAll();
                }
            });
            
            // Log keyboard shortcuts
            log('Keyboard shortcuts:', 'info');
            log('  Ctrl+A: Add row', 'info');
            log('  Ctrl+R: Remove first row', 'info');
            log('  Ctrl+I: Manual reindex', 'info');
        });
    </script>
</body>
</html>