<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Bootswatch</title>
	<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.8/dist/cerulean/bootstrap.css">
	<link rel="stylesheet" type="text/css" href="bootstrap.css">
</head>
<body class="d-flex flex-column bg-primary-subtle bg-opacity-75 min-vh-100 border border-danger">
	<!-- top nav -->
	<nav class="navbar navbar-expand-lg bg-primary" data-bs-theme="dark">
		<div class="container-fluid">

				<img
					src="skeleton.png"
					class="img-fluid rounded"
					style="width:5%;"
				>
			<a class="navbar-brand border border-danger" href="#">
				Title
			</a>
			<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarColor01" aria-controls="navbarColor01" aria-expanded="false" aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>
			<div class="collapse navbar-collapse" id="navbarColor01">
				<ul class="navbar-nav mx-auto">
					<li class="nav-item">
						<a class="nav-link active" href="#">Home
							<span class="visually-hidden">(current)</span>
						</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="#">Features</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="#">Pricing</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="#">About</a>
					</li>
					<li class="nav-item dropdown">
						<a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Dropdown</a>
						<div class="dropdown-menu">
							<a class="dropdown-item" href="#">Action</a>
							<a class="dropdown-item" href="#">Another action</a>
							<a class="dropdown-item" href="#">Something else here</a>
							<div class="dropdown-divider"></div>
							<a class="dropdown-item" href="#">Separated link</a>
						</div>
					</li>
				</ul>
				<form class="d-flex">
					<input class="form-control me-sm-2" type="search" placeholder="Search">
					<button class="btn btn-secondary my-2 my-sm-0" type="submit">Search</button>
				</form>
			</div>
		</div>
	</nav>
	<!-- top nav end -->

	<!-- content container -->
	<div class="container-fluid flex-fill border border-success">
		<div class="row d-flex flex-column flex-fill border border-danger">
			<div class="col-sm-2 flex-fill border border-danger">
			</div>
			<div class="col-sm-8 border border-danger">










<div class="col-sm-12 m-0 my-2">
	<button type="button" id="serial_add" class="btn btn-sm btn-outline-info">Add Row</button>
</div>
<div id="serial_wrap" class="col-sm-12 m-0 my-2"></div>







			</div>
			<div class="col-sm-2 flex-fill border border-danger">
			</div>
		</div>
	</div>
	<!-- content container end -->

	<!-- footer -->
	<div class="container m-0 mx-auto py-1 align-self-end text-center text-sm text-light-emphasis">
		&copy; My Themes<br />Themes By Bootswatch
	</div>
	<!-- footer end -->
</body>
<script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
<script src="remAddRow.js" ></script>
<script type="text/javascript">
	jQuery.noConflict ();
	(function($){
		$(document).ready(function(){

///////////////////////////////////////////
/*
var wrapper	= $("#serial_wrap");
var addBtn	= $("#serial_add");
var fieldName = 'per';
var rowIndex = 'rowserial';
var maxfields = 5;
// Configuration for reindexing patterns
var reindexRowName = ['name'];		// Pattern: ${fieldName}[${index}][field]
var reindexRowID = ['id', 'for'];	// Pattern: userdefine_${index}
var reindexRowIndex = ['data-index', 'index'];	// Pattern: [${index}]

var i = 0;
$(addBtn).click(function(e){

	if(i < maxfields){

		wrapper.append(`

			<div id="rowserial_${i}" class="row m-0 rowserial">
				<input type="hidden" name="${fieldName}[${i}][id]" value="">

				<div class="form-group row m-0">
					<label for="name_${i}" class="col-form-label col-sm-4">Name #${i} : </label>
					<div class="col-sm-8 my-auto">
						<input type="text" name="${fieldName}[${i}][name]" value="" id="name_${i}" class="form-control form-control-sm" placeholder="Name">
					</div>
				</div>

				<div class="form-group row m-0">
					<label for="skill_${1}" class="col-form-label col-sm-4">Skill #${i} : </label>
					<div class="col-sm-8 my-auto">
						<input type="text" name="${fieldName}[${i}][skill]" value="" id="skill_${1}" class="form-control form-control-sm" placeholder="Skill">
					</div>
				</div>

				<div class="col-sm-4 m-0">
					<button type="button" class="btn btn-sm btn-outline-danger serial_remove" data-index="${i}">Remove</button>
				</div>

			</div>

		`);	// end wrapper
		i++;

	}	// end if

	// e.preventDefault();			// onAdd callback

});


// Function 1: Reindex attributes with pattern ${fieldName}[${index}][field]
function reindexRowNamePattern($wrapper, fieldName, rowClass, attributes) {
		if (!attributes || !attributes.length) return;

		const $rows = $wrapper.find('.' + rowClass);

		$rows.each(function(newIndex) {
				const newPosition = newIndex;
				const $row = $(this);

				// Process each attribute in the array
				attributes.forEach(function(attrName) {
						// Find elements with this attribute that contain the fieldName pattern
						$row.find('[' + attrName + '*="' + fieldName + '"]').each(function() {
								const $element = $(this);
								const attrValue = $element.attr(attrName);

								// Match pattern like fieldName[1][fieldname]
								const regex = new RegExp(fieldName + '\\[(\\d+)\\]');
								const match = attrValue.match(regex);

								if (match && match[1]) {
										// Replace only the index number
										const newValue = attrValue.replace(
												fieldName + '[' + match[1] + ']',
												fieldName + '[' + newPosition + ']'
										);
										$element.attr(attrName, newValue);
								}
						});
				});
		});
}

// Function 2: Reindex attributes with pattern userdefine_${index}
function reindexRowIDPattern($wrapper, fieldName, rowClass, attributes) {
		if (!attributes || !attributes.length) return;

		const $rows = $wrapper.find('.' + rowClass);

		$rows.each(function(newIndex) {
				const newPosition = newIndex;
				const $row = $(this);

				// Update row ID itself first
				$row.attr('id', fieldName + '_' + newPosition);

				// Process each attribute in the array
				attributes.forEach(function(attrName) {
						$row.find('[' + attrName + '*="_"]').each(function() {
								const $element = $(this);
								const attrValue = $element.attr(attrName);

								if (attrValue && attrValue.match(/_\d+$/)) {
										const newValue = attrValue.replace(/_\d+$/, '_' + newPosition);
										$element.attr(attrName, newValue);
								}
						});
				});
		});
}

// Function 3: Reindex attributes with pattern [${index}]
function reindexRowIndexPattern($wrapper, fieldName, rowClass, attributes) {
		if (!attributes || !attributes.length) return;

		const $rows = $wrapper.find('.' + rowClass);

		$rows.each(function(newIndex) {
				const newPosition = newIndex;
				const $row = $(this);

				// Update row data-index
				$row.attr('data-index', newPosition);

				// Process each attribute in the array
				attributes.forEach(function(attrName) {
						$row.find('[' + attrName + ']').each(function() {
								const $element = $(this);
								const attrValue = $element.attr(attrName);

								// Check if it's a number or contains a number pattern
								if (attrValue && !isNaN(attrValue)) {
										$element.attr(attrName, newPosition);
								}
						});
				});
		});
}

// Master function
function reindexRowAll($wrapper, fieldName, rowClass, nameAttrs, idAttrs, indexAttrs) {
		reindexRowIDPattern($wrapper, fieldName, rowClass, idAttrs);
		reindexRowNamePattern($wrapper, fieldName, rowClass, nameAttrs);
		reindexRowIndexPattern($wrapper, fieldName, rowClass, indexAttrs);
}


$(wrapper).on("click",".serial_remove", function(e){

	var idIndex = $(this).data('index');
	var $row = $(`#${rowIndex}_${idIndex}`)??$(this).parent().parent(`.${rowIndex}`);
	console.log($row);

	// e.preventDefault();			// after onRemove callback

	$row.remove();
	i--;

	// Reindex with custom attribute arrays
	reindexRowAll(
		$(wrapper),
		fieldName,
		rowIndex,
		reindexRowName,   // ['name']
		reindexRowID,     // ['id', 'for']
		reindexRowIndex   // ['data-id', 'index']
	);


})
*/
///////////////////////////////////////////
			$('#serial_wrap').remAddRow({
				addButton: '#serial_add',
				maxRows: 5,
				fieldName: 'per',
				reindexRowName: ['data-name'],	// pattern => ${name}[${i}][product]
				reindexRowID: ['data-id-id'],		// pattern => userdefined_${i}
				reindexRowIndex: ['row-index'],		// pattern => ${i}
				rowTemplate: (i, name) => `
	        <div id="${name}_${i}" class="row m-0 rowserial" data-index="${i}">
	            <div class="col-sm-5">
	                <input type="text"
	                       name="${name}[${i}][product]"
	                       placeholder="Product name"
	                       class="form-control"
												 data-name="${name}[${i}][product]"
												 data-id-id="exp_${i}"
												 row-index="${i}"
	                       required>
	            </div>
	            <div class="col-sm-5">
	                <input type="number"
	                       name="${name}[${i}][quantity]"
	                       placeholder="Quantity"
	                       class="form-control"
	                       min="1"
	                       value="1">
	            </div>
	            <div class="col-sm-2">
	                <button type="button"
	                        class="btn btn-danger serial_remove"
	                        data-index="${i}">
	                    ×
	                </button>
	            </div>
	        </div>
					`,
				onAdd: (index, event, $row, name) => {
					console.log(`✅ Added row ${index} with field name: ${name}`);

					// Auto-focus the first input
					setTimeout(() => {
							$row.find('input').first().focus();
					}, 100);
				},
				onRemove: (index, event, $row, name) => {
					const productName = $row.find(`input[name="${name}[${index}][product]"]`).val();

					// Ask for confirmation with product name
					const confirm = window.confirm(`Delete "${productName || 'this item'}"?`);

					if (!confirm) {
						console.log(`❌ Removal cancelled for row ${index}`);
						return false; // ❌ BLOCK removal
					}

					console.log(`✅ Allowed removal of row ${index}`);
					return true; // ✅ ALLOW removal (reindexing will happen)
				}
			});









///////////////////////////////////////////
		});
	})(jQuery);
</script>
</html>
