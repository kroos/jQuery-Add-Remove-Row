<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Bootswatch</title>
	<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.8/dist/cerulean/bootstrap.css">
	<link rel="stylesheet" type="text/css" href="bootstrap.css">
</head>
<body class="d-flex flex-column bg-primary-subtle bg-opacity-75 min-vh-100 border border-danger">
	<!-- top nav -->
	<nav class="navbar navbar-expand-lg bg-primary" data-bs-theme="dark">
		<div class="container-fluid">

				<img
					src="skeleton.png"
					class="img-fluid rounded"
					style="width:5%;"
				>
			<a class="navbar-brand" href="#">
				Title
			</a>
			<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarColor01" aria-controls="navbarColor01" aria-expanded="false" aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>
			<div class="collapse navbar-collapse" id="navbarColor01">
				<ul class="navbar-nav mx-auto">
					<li class="nav-item">
						<a class="nav-link active" href="#">Home
							<span class="visually-hidden">(current)</span>
						</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="#">Features</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="#">Pricing</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="#">About</a>
					</li>
					<li class="nav-item dropdown">
						<a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Dropdown</a>
						<div class="dropdown-menu">
							<a class="dropdown-item" href="#">Action</a>
							<a class="dropdown-item" href="#">Another action</a>
							<a class="dropdown-item" href="#">Something else here</a>
							<div class="dropdown-divider"></div>
							<a class="dropdown-item" href="#">Separated link</a>
						</div>
					</li>
				</ul>
				<form class="d-flex">
					<input class="form-control me-sm-2" type="search" placeholder="Search">
					<button class="btn btn-secondary my-2 my-sm-0" type="submit">Search</button>
				</form>
			</div>
		</div>
	</nav>
	<!-- top nav end -->

	<!-- content container -->
	<div class="container d-flex flex-fill border border-success">
		<div class="col-sm-12 m-0 mx-auto d-flex justify-content-between border border-danger">
			<div class="col-sm-2 p-2 border border-danger">
				LET COLUMN
			</div>
			<div class="col-sm-8 p-2 border border-info">

				<div class="col-sm-12 m-0 my-2">
					<button type="button" id="serial_add" class="btn btn-sm btn-outline-info">Add Row</button>
				</div>
				<div id="serial_wrap" class="col-sm-12 m-0 my-2"></div>

			</div>
			<div class="col-sm-2 p-2 border border-danger">
				RIGHT COLIMN
			</div>
		</div>
	</div>
	<!-- content container end -->

	<!-- footer -->
	<div class="container m-0 mx-auto py-1 align-self-end text-center text-sm text-light-emphasis">
		&copy; My Themes<br />Themes By Bootswatch
	</div>
	<!-- footer end -->
</body>
<script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.26.17/dist/sweetalert2.all.min.js"></script>
<script src="addRemoveRowjQueryPlugins.js" ></script>
<script type="text/javascript">
	jQuery.noConflict ();
	(function($){
		$(document).ready(function(){

///////////////////////////////////////////
/*
			$('#serial_wrap').remAddRow({
				addBtn: '#serial_add',
				maxRows: 5,
				fieldName: 'per',
				rowSelector: 'rowserial',
				reindexRowName: ['data-name'],	// pattern => ${name}[${i}][product]
				reindexRowID: ['data-id-id'],		// pattern => userdefined_${i}
				reindexRowIndex: ['row-index'],		// pattern => ${i}
				rowTemplate: (i, name) => `
	        <div id="rowserial_${i}" class="row m-0 rowserial">
	            <div class="col-sm-5">
	                <input type="text"
	                       name="${name}[${i}][product]"
	                       placeholder="Product name"
	                       class="form-control"
												 data-name="${name}[${i}][product]"
												 data-id-id="exp_${i}"
												 row-index="${i}"
	                       required>
	            </div>
	            <div class="col-sm-5">
	                <input type="number"
	                       name="${name}[${i}][quantity]"
	                       placeholder="Quantity"
	                       class="form-control"
	                       min="1"
	                       value="1">
	            </div>
	            <div class="col-sm-2">
	                <button type="button"
	                        class="btn btn-danger serial_remove"
	                        data-index="${i}">
	                    ×
	                </button>
	            </div>
	        </div>
					`,
				onAdd: (index, event, $row, name) => {
					console.log(`✅ Added row ${index} with field name: ${name}`);

					// Auto-focus the first input
					setTimeout(() => {
							$row.find('input').first().focus();
					}, 100);
				},
				onRemove: (index, event, $row, name) => {
					const productName = $row.find(`input[name="${name}[${index}][product]"]`).val();

					// Ask for confirmation with product name
					const confirm = window.confirm(`Delete "${productName || 'this item'}"?`);

					if (!confirm) {
						console.log(`❌ Removal cancelled for row ${index}`);
						return false; // ❌ BLOCK removal
					}

					console.log(`✅ Allowed removal of row ${index}`);
					return true; // ✅ ALLOW removal (reindexing will happen)
				}
			});
*/
///////////////////////////////////////////
/*
			$('#serial_wrap').remAddRow({
				addBtn: '#serial_add',
				rowSelector: 'test',
				removeClass: 'remove',
				rowTemplate: (i, name) => `
					<div id="test_${i}" class="col-sm-8 my-2 d-flex justify-content-evenly m-0 test">
						<span id="mi_${i}">Gerabah!!</span>
						<button type="button" class="btn btn-sm btn-outline-danger remove" data-id="${i}">X</button>
					</div>
				`,
				onAdd: (i, e, $row, name) => {
					$(`#mi_${i}`).css({"color": "red", "border": "2px solid red"});
				},
				onRemove:(i, e, $row, name) => {
					console.log(`Removing row id=${i} => `);
					$(`#mi_${i}`).css({"color": "red", "border": "2px solid red"});
				},
			});
*/

///////////////////////////////////////////

			$('#serial_wrap').remAddRow({
				addBtn: '#serial_add',
				maxRows: 5,
				fieldName: `per`,
				rowSelector: 'rowserial',
				reindexRowName: ['data-name'],	// pattern => ${name}[${i}][product]
				reindexRowID: ['data-id-id'],		// pattern => userdefined_${i}
				reindexRowIndex: ['row-index'],		// pattern => ${i}
				rowTemplate: (i, name) => `
					<div id="rowserial_${i}" class="row m-0 rowserial">
						<div class="col-sm-5">
							<input type="text"
								name="${name}[${i}][product]"
								placeholder="Product name"
								class="form-control"
								data-name="gerabah[${i}][model]"
								data-id-id="exp_${i}"
								row-index="${i}"
								required>
						</div>
						<div class="col-sm-2">
							<button type="button"
								class="btn btn-sm btn-outline-danger serial_remove"
								data-index="${i}">
							×
							</button>
						</div>
					</div>
					`,
				onAdd: (index, event, $row, name) => {
					console.log(`Added row ${index} with field name: ${name}`);
				},
				onRemove: async (index, event, $row, name) => {

					const idv = $row.find(`input[name="${name}[${index}][id]"]`);

					dbId = idv.val();

					console.log(idv.length);
					if(idv.length >= 0){
						return true;
					}

					if (!dbId) {
						return true;
					}

					let url = `api/products`;

					const result = await swal.fire({
						title: 'Are you sure?',
						text: "It will be deleted permanently!",
						type: 'warning',
						confirmButtonText: 'Yes, delete it!',
						showCancelButton: true,
						allowOutsideClick: false,
						showLoaderOnConfirm: true,
					});

					// ❌ Cancel clicked
					if (result.isDismissed) {
						await swal.fire('Cancelled', 'Your data is safe from delete', 'info' );
						return false;
					}
					// 2️⃣ Perform AJAX delete
					try {
						const response = await $.ajax({
							type: 'DELETE',
							url: `${url}/${dbId}`,
							data: {
								_token: `{{ csrf_token() }}`,
								id: dbId
							},
							dataType: 'json'
						});
						await swal.fire('Deleted!', response.message, response.status);
					} catch (e) {
						await swal.fire( 'Ajax Error', 'Something went wrong with ajax!', 'error' );
						return false; // ❌ BLOCK removal
					}

				}
			});

///////////////////////////////////////////
		});
	})(jQuery);
</script>
</html>
